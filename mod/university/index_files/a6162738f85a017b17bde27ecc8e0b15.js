function BirthdayCheck(e,t){this.template=$(e),this.input=$(t),this.initial=this.input.val()}function StickerModal(){this.modal=$("#sticker"),this.shade=$("#blackout"),this.data={},this.bind()}function Reel(e){this.el=$(e),this.reel=e.find(".reel"),this.slides=e.find("section").detach().get(),this.current=0,this.reset(),this.bind()}$(function(){var e=$("body.account #settings > form");if(e.length){var t=new BirthdayCheck($("#confirm-birthday"),e.find("input[name=birthday]"));e.on("submit",function(n){return!t.passed&&t.should()?(t.start(function(){e[0].submit()}),n.stopImmediatePropagation(),!1):void 0});var n=$("#photo"),r=n.find("li.profile, li.cover"),o=location.reload.bind(location,!0);r.uploader({maxFilesize:10,acceptedFiles:"image/*",processing:n.addClass.bind(n,"loading"),success:setTimeout.bind(null,o,5e3),error:o})}}),BirthdayCheck.prototype.should=function(){var e=this.value();return this.initial!==e&&/^\d+\/\d+\/\d+$/.test(e)?!0:!1},BirthdayCheck.prototype.value=function(){return this.input.val()},BirthdayCheck.prototype.date=function(){var e=this.value().split("/");return new Date(parseInt(e[2],10),parseInt(e[0],10)-1,parseInt(e[1],10))},BirthdayCheck.prototype.age=function(){var e=this.date();return moment().diff(e,"years")},BirthdayCheck.prototype.start=function(e){function t(){var e=r.find("input[type=password]").val();$.post("/account/verify",{password:e}).done(function(){r.removeClass("password").addClass("age"),r.find("span.dob").text(o),r.find("span.age").text(i)}).fail(function(){alert("Password check failed. Please try again.")})}function n(){this.input.val(this.initial).trigger("change"),this.close()}this.modal&&this.modal.remove(),this.modal=this.template.clone().insertAfter(this.template),this.modal.addClass("active password");var r=this.modal,o=this.value(),i=this.age();r.find("input[name=confirm]").on("click",e.bind(null)),r.find("input[name=verify]").on("click",t.bind(this)),r.find("input[type=password]").on("keyenter",t.bind(this)),r.find("input[name=cancel]").on("click",n.bind(this))},BirthdayCheck.prototype.close=function(){this.modal&&this.modal.remove()},$(function(){$("body.admin.announcements .announcement").each(function(){function e(){var e=r.val().trim();t.find("h2.crumbs .primary").text(e||"?")}var t=$(this),n=t.find("form");t.find("a.save").click(function(e){e.preventDefault(),n.submit()}),t.on("click","a.delete",function(e){e.preventDefault(),$(this).parent().remove()}),t.on("click","a.add",function(e){e.preventDefault();var t=$(this).parent().parent().find(".template"),n=t.parent().children(t.prop("tagName")).length-1,r=t.clone();r.removeClass("template").find("input, select").each(function(){var e=$(this);e.attr("name",e.attr("data-name").replace("[0]","["+n+"]"))}),r.insertBefore(t)}),t.on("change",".buttons .button .field.type select",function(){var e=$(this);e.parents(".button").find(".url input").attr("readonly","link"!==e.val())}),t.find("a.upload").each(function(){var e=$(this),t=e.parent(),n=t.find("input"),r=n.val();e.uploader({maxFilesize:10,acceptedFiles:"image/*",processing:function(){t.addClass("loading"),n.val("")},success:function(r,o){t.removeClass("loading"),n.val(o.url),e.show()},error:function(){alert("Asset upload failed."),t.removeClass("loading"),n.val(r),e.show()}})}),n.find("a.duplicate").click(function(e){e.preventDefault(),$(this).hide().prev("input").removeAttr("disabled"),n.attr("action",n.attr("data-create-url"))});var r=t.find("input[name=id]");r.keyup(e),e()})}),$(function(){function e(e,t){return e.url+"/"+e.ios[t||"1x"].file}$("body.admin.moments").each(function(){function t(){var e=$.trim(s.val());e!==o&&(o=e,r&&r.abort(),r=$.get(u,{query:e},n))}function n(t){var n=t.moments;if(n){var r=t.users;if(r){c.find("li[class!=template]").remove();var o=[];_.each(n,function(t){var n=l.filter("."+t.type);if(!n.length)return console.warn("No template for moment type: "+t.type),void 0;var i=n.clone().removeClass("template");i.attr("data-moment-id",t.id);var a=r[t.user_id],s=e(t.photo.photo),c=e(a.photo);i.css("background-image",'url("'+s+'")').find(".user").css("background-image",'url("'+c+'")'),o.push(i)}),c.append(o)}}}var r,o,i=$(this),a=i.find("form"),s=i.find("input"),c=i.find("ul.moments"),l=c.find("li.template"),u=a.attr("action");c.on("click","li",function(){var e=$(this).attr("data-moment-id");window.open("https://path.com/p/"+e)}),a.on("submit",function(){return!1}),s.on("keyup",_.debounce(t,300)),t()})}),$(function(){function e(){location.reload(!0)}var t=$(window);$("body.admin.postal").each(function(){var e=$(this);e.on("click","a.create-template",function(e){e.preventDefault(),$.postJSON($(this).attr("href")).done(function(e){window.location=e.url})})}),$("body.admin.postal .template-detail").each(function(){function t(){return n.find(".backends .backend .toggle.on").map(function(){return $(this).parents(".backend").attr("data-id")}).get()}var n=$(this);n.on("click","a.add-content",function(t){t.preventDefault(),$.post($(this).attr("href"),e)}),n.on("click",".tcontent a.delete",function(t){t.preventDefault();var n=$(this).parents(".tcontent").attr("data-index");$.post($(this).attr("href"),{index:n},e)}),n.on("click","a.balance-variance",function(t){t.preventDefault(),$.post($(this).attr("href"),e)}),n.on("click","a.save",function(e){e.preventDefault();var r={id:n.find("input[name=id]").val(),target_id:n.find("select[name=target_id]").val(),backends:t()};$.postJSON($(this).attr("href"),r).done(function(e){window.location=e.url})}),n.on("click",".backend .toggle button",function(e){e.preventDefault(),$(this).parents(".toggle").toggleClass("on off")}),n.on("click",".start-campaign a.start",function(e){e.preventDefault(),$.post($(this).attr("href"),function(e){window.location=e.url})})}),$("body.admin.postal .template-content").each(function(){var n=$(this),r=n.attr("data-channel-id"),o=ace.require("ace/edit_session").EditSession;o.prototype.$startWorker=function(){},window.editors={},n.find(".editor").each(function(){var e=$(this),t=ace.edit(e.get()[0]);t.setTheme("ace/theme/chrome"),t.setHighlightActiveLine(!1),t.setShowPrintMargin(!1),t.renderer.setPadding(10),t.renderer.setScrollMargin(10),t.getSession().setMode("ace/mode/"+e.attr("data-ace-mode")),window.editors[e.attr("data-name")]=t}),n.on("click","a.save",function(t){t.preventDefault();var o={variance:n.find("input[name=variance]").val(),text:window.editors.text.getSession().getValue()};"email"===r&&(o.subject=n.find("input[name=subject]").val(),o.html=window.editors.html.getSession().getValue(),o.css=window.editors.css.getSession().getValue()),$.postJSON($(this).attr("href"),o).done(e)}),t.scroll(function(){n.find(".datasheet").css("margin-top",t.scrollTop())})}),$("body.admin.postal .template-preview").each(function(){function e(){if(n()){l=!0,u.hide(),d.hide(),s.css("opacity",.5);var e=o();e.targets=r();var t=s.attr("href")+"?"+$.param(e);$.postJSON(t).complete(function(){l=!1,s.css("opacity",1)}).done(function(){u.show()}).fail(function(){d.show()})}}function t(){n()?(s.removeClass("send-inactive"),i()):s.addClass("send-inactive")}function n(){return l?void 0:_.every(a,function(e){return""!==$(e).val().trim()})}function r(){return a.filter("[name=target]").val()}function o(){var e={};return a.filter("[name!=target]").each(function(){var t=$(this);e[t.attr("name")]=t.val()}),e}var i=$(this),a=i.find(".field.target input, .field.params input"),s=i.find("a.send"),c=i.find(".preview"),l=!1,u=i.find(".status .ok").hide(),d=i.find(".status .fail").hide();a.on("keyup",t),s.on("click",function(t){t.preventDefault(),e()});var i=_.debounce(function(){if(n()){var e=o();e.targets=r();var t=c.attr("data-preview-url")+"?"+$.param(e);c.find("iframe").attr("src",t)}},1e3);t()}),$("body.admin.postal .campaign-detail").each(function(){function t(){var n=window.location.href+"?json=1";$.get(n).done(function(n){n.active&&n.cycle_ts?(a.find("span").text(moment(1e3*n.cycle_ts).format("MMMM D [at] h:mma")),i.hide(),a.show()):(a.hide(),i.show()),s.text(numeral(n.queued).format("0,0")),c.text(numeral(n.sent).format("0,0")),l.text(numeral(n.size).format("0,0")),u.find("tr:not(.template)").remove();var o=u.find("tr.template"),d=[];n.history.reverse().forEach(function(e){var t=moment(1e3*e.time),n=o.clone().removeClass("template"),r="?";void 0!==e.test&&(r=e.test?"Yes":"No"),n.find("td.date").text(t.format("dddd, MMM Do [at] h:mma")).end().find("td.sent").text(numeral(e.sent).format("0,0")).end().find("td.delivered").text(numeral(e.delivered).format("0,0")).end().find("td.removed").text(numeral(e.removed).format("0,0")).end().find("td.test").text(r).end(),d.push(n)}),u.append(d),!n.active&&r&&e(),n.active&&setTimeout(t,2e3)}).fail(function(){setTimeout(t,5e3)})}var n=$(this),r=1===n.find("a.stop").length,o=n.find("article.cycle"),i=o.find(".none"),a=o.find(".date"),s=n.find(".status .queue p"),c=n.find(".status .sent p"),l=n.find(".status .size p"),u=n.find(".history table tbody");n.find("a.target").uploader({maxFilesize:1024,success:e,error:e}),n.on("click","a.start, a.stop",function(t){t.preventDefault();var n=$(t.target).hasClass("start")?"start":"stop";confirm("Are you sure you want to "+n+" this campaign?")&&$.post($(this).attr("href")).complete(e)}),n.on("click","a.save",function(e){e.preventDefault();var t={id:n.find("input[name=id]").val(),template_id:n.find("select[name=template_id]").val(),repeat:n.find("select[name=repeat]").val(),test:"1"===n.find("select[name=test]").val()};$.postJSON($(this).attr("href"),t).done(function(e){window.location=e.url})}),t()})}),$(function(){$("body.admin.users").each(function(){function e(){var e=$.trim(i.val());e!==n&&(n=e,t&&t.abort(),t=$.get(c,{query:e},function(e){a.find("li[class!=template]").remove();var t=e.users||[],n=[];_.each(t,function(e){var t=moment(new Date(e.joined)),r=s.clone().removeClass("template"),o=r.find("a");o.attr("href",o.attr("href").replace(":id",e.id)),r.attr("data-user-id",e.id),r.find("img").attr("src",e.photo.url),r.find("h3").text(e.name),r.find("p span").text(t.format("MMM YYYY")),e.friend&&r.addClass("friend"),n.push(r)}),t.length||n.push($("<li />",{"class":"empty",text:"No users found. Try another query."})),a.append(n)}))}var t,n,r=$(this),o=r.find("form"),i=r.find("input"),a=r.find("ul.userlist"),s=a.find("li.template"),c=o.attr("action");o.on("submit",function(){return!1}),i.on("keyup",_.debounce(e,300)),e()})}),$(function(){var e=$("meta[name=csrf]").attr("content");$(document).ajaxSend(function(t,n,r){"POST"===r.type&&n.setRequestHeader("X-CSRF-TOKEN",e)}),$.postJSON=function(e,t){return $.ajax({url:e,type:"POST",dataType:"json",data:JSON.stringify(t||{}),contentType:"application/json"})}}),$(function(){if($("body.blog").length){var e=$(window);$("#blog-list").each(function(){var t=$(this),n=1,r=!1;e.scroll(function(){if(!r){var o=e.scrollTop()/(document.body.scrollHeight-e.height());.9>o||(r=!0,$.get("/blog/"+ ++n,function(e){t.append(e),r=!1}))}})})}}),$(function(){var e=$("body.developers.admin");e&&e.find("article.clientlist").each(function(){function e(){var e=$.trim(i.val().toLowerCase()),t=[],r=a.filter("input[name=live]").is(":checked");r&&t.push("live");var s=a.filter("input[name=review]").is(":checked");s&&t.push("review"),t.length||(t=["live","review"]);var c=[];_.each(o,function(n,r){n=$(n);var o=n.find("a").text().toLowerCase();(""===e||-1!==o.indexOf(e))&&-1!==t.indexOf(n.attr("class"))&&c.push("#"+r)}),n.hide(),c?$(c.join(",")).show():n.show()}var t=$(this),n=t.find("li"),r=t.find(".filter"),o=_.chain(n).map(function(e){var e=$(e);return[e.attr("id"),e[0]]}).object().value(),i=r.find("input[name=search]");i.on("keyup",e);var a=r.find("input[type=checkbox]");a.on("change",e)})}),$(function(){var e=$("body.developers.client, body.developers.create").find("#developers form");e.length&&e.find("fieldset.users").each(function(){function e(e){if(/.*@.*/.test(e)&&!o.find('[data-email="'+e+'"]').length){var n=o.find(".empty").clone().appendTo(o);n.removeClass("empty").attr("data-email",e).find("em").text(e),$.get("/developers/find-user/"+e).done(function(e){return o.find('[data-user-id="'+e.id+'"]').length?(n.remove(),void 0):(n.removeClass("finding").addClass("user").removeAttr("data-email").attr("data-user-id",e.id).find("span").text($.trim(e.fname+" "+e.lname)).end().find("i").css("background-image",'url("'+e.photo+'")'),t(),void 0)}).fail(function(){n.remove()})}}function t(){var e=_.map(o.find("li.user"),function(e){return $(e).attr("data-user-id")}).join(",");a.val(e)}var n=$(this),r=$("article.client").parent();r.find(".change-icon").uploader({maxFilesize:10,acceptedFiles:"image/*",success:location.reload.bind(location,!0),error:function(e,t){r.find(".notification.error").remove(),r.prepend($("<div />",{"class":"notification error",text:"string"==typeof t?t:t.error}))}});var o=n.find("ul");n.on("click","button.remove",function(){return $(this).parent("li").remove(),t(),!1});var i=n.find(".field.search input");i.on("keyenter",function(){var t=$(this);return _.chain(t.val().split(",")).map($.trim).each(e),t.val(""),!1});var a=n.find("input[name=users]")})}),$(function(){$("body").on("keypress",":input",function(e){if(13===e.keyCode){var t=$.Event("keyenter");$(this).trigger(t),t.isDefaultPrevented()&&e.preventDefault(),t.isPropagationStopped()&&e.stopPropagation(),t.isImmediatePropagationStopped()&&e.stopImmediatePropagation()}})}),$(function(){$("form").each(function(){var e=$(this).data("submitting",!1);e.on("submit",function(){return e.data("submitting")?!1:(e.data("submitting",!0),!0)})}),$("form .field-birthday").each(function(){var e=$(this),t=e.find("input").dateinput(),n=e.find("select").datepicker();t.on("change",function(){n.setArray(t.toArray())}),n.on("change",function(){t.setDate(n.toDate())})}),$("form.overlay").each(function(){var e=$("#content");$(this).find("input, button").on({focus:e.addClass.bind(e,"dim"),blur:e.removeClass.bind(e,"dim")})})}),$.fn.dateinput=function(){return 1===this.length?(this.toArray=function(){return this.val().split("/")}.bind(this),this.isDate=function(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:isNaN(e.getTime())?!1:!0},this.setDate=function(e){var t="";this.isDate(e)&&(t=[e.getMonth()+1,e.getDate(),e.getFullYear()].join("/")),this.val(t)}.bind(this),this):void 0},$.fn.datepicker=function(){if(3===this.length){var e=this.filter("[name=month]"),t=this.filter("[name=day]"),n=this.filter("[name=year]");if(3===e.length+t.length+n.length)return this.setArray=function(r){e.val(r[0]),t.val(r[1]),n.val(r[2])},this.toArray=function(){return[parseInt(n.val(),10),parseInt(e.val(),10),parseInt(t.val(),10)]},this.toDate=function(){var e=this.toArray();return new Date(e[0],e[1]-1,e[2])}.bind(this),this}},$.fn.uploader=function(e){var e=_.defaults({},{headers:{"X-CSRF-TOKEN":$("meta[name=csrf]").attr("content")},createImageThumbnails:!1},e);$(this).each(function(){var t=$(this),n="A"===t.prop("tagName")&&t||t.find("a");n.on("click",function(e){e.preventDefault()});var r=e.processing,o=e.complete;t.dropzone(_.extend(e,{url:n.prop("href"),clickable:n[0],processing:function(){t.addClass("uploading"),r&&r()},complete:function(){t.removeClass("uploading"),o&&o()}}))})},$(function(){$("#friends section.search").each(function(){function e(){var e=$.trim(i.val());e!==n&&(n=e,t&&t.abort(),t=$.get(c,{query:e},function(e){a.find("li[class!=template]").remove();var t=e.users||[],n=[];_.each(t,function(e){var t=moment(new Date(e.joined)),r=s.clone().removeClass("template");r.attr("data-user-id",e.id),r.find("img").attr("src",e.photo.url),r.find("h3").text(e.name),r.find("p span").text(t.format("MMMM YYYY")),e.friend&&r.addClass("friend"),n.push(r)}),t.length||n.push($("<li />",{"class":"empty",text:"No users found. Try another query."})),a.append(n)}))}var t,n,r=$(this),o=r.find("form"),i=r.find("input"),a=r.find("ul.userlist"),s=a.find("li.template"),c=o.attr("action");o.on("submit",function(){return!1}),i.on("keyup",_.debounce(e,300))}),$("#friends").on("click","ul.userlist a.add",function(){var e=$(this),t=e.parents("li");return t.addClass("friend"),$.post("/friends/add",{id:t.attr("data-user-id")}),!1})}),$(function(){$(".grid").each(function(){function e(){var e=r.find("tbody tr:not(.template)"),o=n();if(!o.length)return e.show(),a.text(e.length),void 0;var i=[];e.hide().each(function(){var e=$(this),n=_.every(o,function(n){var r=e.find("td:nth-child("+n.index+")").text();return t(n.value,r)},[]);n&&i.push(e[0])}),a.text(i.length),$(i).show()}function t(e,t){return e=$.trim(e).toLowerCase(),_.every(e.split(","),function(e){return t=$.trim(t).toLowerCase(),t&&-1!==t.indexOf(e)})}function n(){return _.reduce(o,function(e,t,n){return t.value?e.concat([{index:n+1,value:t.value}]):e},[])}var r=$(this),o=r.find("tr.filter th input"),i=r.attr("data-count"),a=i?$(i):r.find("span.count");o.on("keyup",e),e()})}),$(function(){function e(){i.addClass("fixed")}function t(){function e(){var e=o.height(),t=e-(l-c);if(s!==e){s>t&&(u=s-t+d-u,a.css("padding-bottom",u));var g=r.scrollTop(),h=l-g;h>c?(i.removeClass("frozen"),n.css("height",h),n.find("hgroup").css("opacity",1-g/(l-c))):(i.addClass("frozen"),n.css("height",c))}}function t(){s=r.height()}var s,c=65,l=n.outerHeight(),u=0,d=parseInt(a.css("padding-bottom"),10);r.resize(t),r.scroll(e),t(),e()}var n=$("body.path3").find("header.opened, header.collapsed");if(n.length&&!navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad|android)/)){var r=$(window),o=$(document),i=$("body"),a=$("#content");e(),n.hasClass("opened")&&t()}}),$(function(){if($("body.home").length){var e=$(window),t=.5,n=$("#signup .learn");e.scroll(function(){var r=e.scrollTop()/e.height();n.css("opacity",1-r/t)}),n.click(function(){return $("body").animate({scrollTop:$("#about").offset().top}),!1})}}),$(function(){$("body.profile #card").each(function(){var e=$(this),t=e.attr("data-user-id"),n=e.find(".add-friend"),r=e.find(".waiting");console.log(n),n.on("click",function(e){e.preventDefault(),$.post($(this).attr("href"),{id:t}),n.hide(),r.show()})})}),$(function(){var e=new StickerModal;e.register($("section.sticker")),e.open((location.hash+"").replace(/^#+/,""))}),StickerModal.prototype.bind=function(){this.shade.add(this.modal.find(".close")).click(function(){return this.close(),!1}.bind(this))},StickerModal.prototype.open=function(e){var t=this.data[e];t&&(this.shade.show(),this.modal.attr("class","").addClass(e).find("h3").text(t.title).end().find("h4").text(t.author).end().find(".content").text(t.description).end().show())},StickerModal.prototype.close=function(){this.shade.hide(),this.modal.hide()},StickerModal.prototype.register=function(e){var t=this;e.each(function(){var e=t.extract(this);t.data[e.id]=e,$(this).click(function(){return t.open(e.id),!1})})},StickerModal.prototype.extract=function(e){return e=$(e),{id:e.attr("class").replace("sticker ",""),title:e.find("hgroup h2").text(),author:e.find("hgroup .author").text(),description:e.find("p.description").text()}},$(function(){$(".slider").each(function(){new Reel($(this))})}),Reel.prototype.load=function(e){var t;if(null==e)t=this.slides.pop();else{var n=this.slides.length;e=0>e?n+(e-2)%n-1:e%n,t=this.slides[e]}return $(t).clone().data("slide-index",e)},Reel.prototype.prev=function(){if(this.lock()){this.current--,this.updateNavColor();var e=this.dimensions(this.reel),t=this.reel.children(),n=t.first().data("slide-index")-1,r=t.filter(".start").prevAll().length;this.reel.prepend(this.load(n).css({left:-(e.width*(r+1))})),this.reel.animate({left:this.reel.position().left+e.width},this.unlock.bind(this))}},Reel.prototype.next=function(){if(this.lock()){this.current++,this.updateNavColor();var e=this.dimensions(this.reel),t=this.reel.children(),n=t.last().data("slide-index")+1,r=t.filter(".start").nextAll().length;this.reel.append(this.load(n).css({left:e.width*(r+1)})),this.reel.animate({left:e.left-e.width/2},this.unlock.bind(this)),this.moving=!1}},Reel.prototype.lock=function(){return this.locked?!1:(this.locked=!0,!0)},Reel.prototype.unlock=function(){this.locked=!1},Reel.prototype.reset=function(e){e||(e=0),this.reel.empty();for(var t=this.dimensions(this.reel),n=this.dimensions($(window)),r=(n.width-t.width)/2,o=Math.ceil(r/t.width),i=-o,a=o+1,s=[];a>i;i++){var c=this.load(e+i).css({left:t.width*i});e===i&&(this.current=e+i,c.addClass("start")),s.push(c)}this.reel.append(s)},Reel.prototype.bind=function(){this.el.on("click","a.prev",function(){return this.prev(),!1}.bind(this)),this.el.on("click","a.next",function(){return this.next(),!1}.bind(this))},Reel.prototype.dimensions=function(e){var t=e.width(),n=e.height(),r=e.offset()||{left:0,top:0};return{width:t,height:n,left:r.left,right:r.left+t,top:r.top,bottom:r.top+n}},Reel.prototype.updateNavColor=function(){var e=this.load(this.current),t=e.hasClass("dark")?"dark":"light";this.el.find("nav").removeClass("light dark").addClass(t)},$(function(){function e(e){this.el=$(e),this.wrap=this.el.parent(),this._v=videojs(e),this.bind()}var t=window;e.prototype.load=function(){this.wrap.click(this.toggle.bind(this)),$(this).click(function(){this.paused()?this.play():this.pause()}.bind(this))},e.prototype.toggle=function(){this._v.paused()?this._v.play():this._v.pause()},e.prototype.bind=function(){this._v.ready(this.load.bind(this))},t.videos=t.videos||[],$("video.video-js").each(function(){t.videos.push(new e(this))})});